---
# tasks file for ad_auth
- name: install packages
  package:
    name: "{{ ad_auth_packages }}"
    state: present
  register: ad_auth_install_packges
  until: ad_auth_install_packges is succeeded
  retries: 3
  notify:
    - restart realmd

- name: install pip packages
  pip:
    name: "{{ ad_auth_pip_packages }}"
    state: present
  register: ad_auth_install_pip_packges
  until: ad_auth_install_pip_packges is succeeded
  retries: 3

- name: place sssd configuration
  template:
    src: sssd.conf.j2
    dest: /etc/sssd/sssd.conf
    mode: "0600"
  notify:
    - restart sssd

- name: join domain
  expect:
    command: "{{ ad_auth_join_command }}"
    responses:
      Password for *: "{{ ad_auth_registration_password }}"
  when:
    - ad_auth_join | bool
